<ion-header class="ion-no-border">
  <app-toolbar type="form-page" title="Formulário" (save)="onSave()"></app-toolbar>
</ion-header>

<ion-content>
  <app-error-message [problem]="problem"></app-error-message>

  <div class="ion-margin">
    <ion-label><small>* Campos obrigatórios</small></ion-label>
  </div>

  <div class="ion-text-center container">
    <ion-item-divider>
      <ion-label>Dados contratuais</ion-label>
    </ion-item-divider>
    <ion-list>
      <ion-item class="ion-align-items-center ion-padding-bottom" lines="none">
        <ion-label>
          <h3>Contratante *</h3>
          <p>{{contract.employer && contract.employer.name !== '' ? contract.employer.name : 'Não possui'}}</p>
        </ion-label>
        <ion-icon slot="start" name="briefcase-outline"></ion-icon>
        <ion-buttons slot="end">
          <ion-button shape="round" color="primary" (click)="setEmployerModalOpen(true)">
            <ion-icon slot="icon-only" name="search"></ion-icon>
            
          </ion-button>
        </ion-buttons>

        <ion-modal #modalEmployer [isOpen]="isEmployerModalOpen" [backdropDismiss]="false">
          <ng-template>
            <ion-header class="ion-no-border">
              <ion-toolbar color="secondary">
                <ion-title>Contratantes</ion-title>
                <ion-buttons slot="end">
                  <ion-button shape="round" (click)="setEmployerModalOpen(false)">
                    <ion-icon slot="start" name="close"></ion-icon>
                    Fechar
                  </ion-button>
                </ion-buttons>
              </ion-toolbar>
            </ion-header>
            <ion-content>
              <app-employer-list-item [employers]="employers" (search)="onSearchEmployer($event)"
              (select)="onSelectEmployer($event)">
              </app-employer-list-item>
            </ion-content>
          </ng-template>
        </ion-modal>
      </ion-item>

      <ion-item class="ion-align-items-center ion-padding-bottom" lines="none">
        <ion-label>
          <h3>Que trabalha *</h3>
          <p>{{contract.employee && contract.employee.name !== '' ? contract.employee.name : 'Não possui'}}</p>
        </ion-label>
        <ion-icon slot="start" name="hammer-outline"></ion-icon>
        <ion-buttons slot="end">
          <ion-button shape="round" color="primary" (click)="setEmployeeModalOpen(true)">
            <ion-icon slot="icon-only" name="search"></ion-icon>
            
          </ion-button>
        </ion-buttons>

        <ion-modal #modalEmployee [isOpen]="isEmployeeModalOpen" [backdropDismiss]="false">
          <ng-template>
            <ion-header class="ion-no-border">
              <ion-toolbar color="secondary">
                <ion-title>Que trabalham</ion-title>
                <ion-buttons slot="end">
                  <ion-button shape="round" (click)="setEmployeeModalOpen(false)">
                    <ion-icon slot="start" name="close"></ion-icon>
                    Fechar
                  </ion-button>
                </ion-buttons>
              </ion-toolbar>
            </ion-header>
            <ion-content>
              <app-employee-list-item [employees]="employees" (search)="onSearchEmployee($event)"
                (select)="onSelectEmployee($event)"></app-employee-list-item>
            </ion-content>
          </ng-template>
        </ion-modal>
      </ion-item>

      <ion-item class="ion-align-items-center ion-padding-bottom" lines="none" *ngIf="contract.employee">
        <ion-label position="stacked">Serviço(s) realizado(s) *</ion-label>
        <ion-icon slot="start" name="information-circle-outline"></ion-icon>
        <ion-select interface="popover" [compareWith]="compareJobs" [(ngModel)]="contract.servicesPerformed"
          placeholder="Selecione..." [multiple]="true">
          <ion-select-option [value]="job" *ngFor="let job of contract.employee.jobs">{{job.name}}</ion-select-option>
        </ion-select>
      </ion-item>


      <ion-item class="ion-align-items-center ion-padding-bottom" lines="none">
        <ion-label position="stacked">Status</ion-label>
        <ion-icon slot="start" name="scale-outline"></ion-icon>
        <ion-select interface="popover" [(ngModel)]="contract.status" placeholder="Selecione...">
          <ion-select-option [value]="status" *ngFor="let status of contractStatuses">{{status | contractStatus}}
          </ion-select-option>
        </ion-select>
      </ion-item>

    </ion-list>
  </div>


  <div class="ion-text-center container">
    <ion-item-divider>
      <ion-label>Avaliação do contrato</ion-label>
    </ion-item-divider>

    <ion-list>
      <ion-item class="ion-align-items-center ion-padding-bottom" lines="none">
        <ion-label position="stacked">Nota de quem trabalhou</ion-label>
        <ion-icon slot="start" name="star-outline"></ion-icon>
        <ion-select interface="popover" placeholder="Selecione..." [(ngModel)]="contract.result.employeeRating">
          <ion-select-option [value]="grade" *ngFor="let grade of [1, 2, 3, 4, 5]">{{grade}}</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item class="ion-align-items-center ion-padding-bottom" lines="none">
        <ion-label position="stacked">Nota do(a) contratante</ion-label>
        <ion-icon slot="start" name="star-outline"></ion-icon>
        <ion-select interface="popover" placeholder="Selecione..." [(ngModel)]="contract.result.employerRating">
          <ion-select-option [value]="grade" *ngFor="let grade of [1, 2, 3, 4, 5]">{{grade}}</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item class="ion-align-items-center ion-padding-bottom" lines="none">
        <ion-label position="stacked">Observações</ion-label>
        <ion-icon slot="start" name="document-text-outline"></ion-icon>
        <ion-input type="text" placeholder="Informe as observações do contrato"
          [(ngModel)]="contract.result.obs">
        </ion-input>
      </ion-item>
    </ion-list>

  </div>



</ion-content>